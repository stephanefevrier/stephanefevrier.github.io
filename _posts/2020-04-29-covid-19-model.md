---
layout: post
title:  "COVID-19 compartmental modelling"
date:   2020-04-29 14:14:20 +0200
categories: Health
permalink: covid-19-model
---

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


This page explores the possibility of fitting a compartmental model for COVID-19. The first part explains the concept of compartmental models and describes the model used, while the second part shows the model fitting and its results.

Data is gathered from the <a href="https://github.com/CSSEGISandData/COVID-19" target="_blank">Johns Hopkins Github repository</a> and <a href="https://www.kaggle.com/sudalairajkumar/novel-corona-virus-2019-dataset" target="_blank">Kaggle</a>. The code is maintained on <a href="https://github.com/stephanefevrier/covid-19-analysis" target="_blank">this repository</a>, made with Python on a Jupyter notebook.


# Compartmental models

Compartmental models are a simple way to model the spread of infectious diseases by separating the population into several meaningful compartments. One of the simplest example of a compartmental model is the SIR model, which is explained below to introduce the concept of compartmental models before showing the actual model used here.

## Quick introduction: SIR model

The SIR model, deterministic and based on ordinary differential equations, consists of 3 compartments: Susceptible ($$S$$), Infectious ($$I$$), and $$R$$ (Recovered). 

### Compartments

Each variable ($$S$$, $$I$$, $$R$$) represents the number of people in the associated compartment and depends on time:

- $$S(t)$$: number of susceptible people on day t 
- $$I(t)$$: number of infectious people on day t
- $$R(t)$$: number of recovered people on day t 

### Equations

The SIR system can be expressed by the following set of ordinary differential equations:

$$\frac{dS}{dt} = -\beta \cdot I \cdot \frac{S}{N}$$ 

$$\frac{dI}{dt} = \beta \cdot I \cdot \frac{S}{N} - \gamma \cdot I$$

$$\frac{dR}{dt} = \gamma \cdot I$$ 

- $$\frac{dS}{dt}$$: $$I$$ infectious people can infect a proportion of $$S/N$$ people, each decreasing the $$S$$ population by $$\beta$$.
- $$\frac{dI}{dt}$$: The population going out of $$S$$ comes to $$I$$ (previous equation, opposite sign). Also, $$I$$ people recover at a rate of $$\gamma$$.
- $$\frac{dR}{dt}$$: The population going out of $$I$$ comes to $$R$$ (second term of previous equation, opposite sign).

### Parameters

The equations are solved using initial conditions ($$S_0$$, $$I_0$$, $$R_0$$), along with the following set of parameters:

- $$N$$: total population
- $$\beta$$: expected amount of people an infectious person infects per day (probability of an infectious person to infect a healthy person $$\times$$ average number of people a person is in contact with per day)
- $$\gamma = 1 / D$$: rate of recovery,  or proportion of infectious recovering per day (inverse of number of days that an infectious person has and can spread the disease)
- $$R_0 = \beta / \gamma$$: basic reproduction number, the expected total number of people an infectious person infects.


## Advanced compartmental model: SEICRD model

The previous model was cool, but we want to be more accurate to model the reality. That's why we built a more advanced compartmental model, a modification of the one presentend in <a href="https://towardsdatascience.com/infectious-disease-modelling-fit-your-model-to-coronavirus-data-2568e672dbc7" target="_blank">this article</a>.

The SEICRD model consists of 5 compartments: Susceptible ($$S$$), Exposed ($$S$$), Infectious ($$I$$), Critical ($$C$$), $$R$$ (Recovered), and Dead ($$D$$). 

### Compartments

Each compartment depends on time.

- $$S(t)$$: number of susceptible people on day t 
- $$E(t)$$: number of exposed people on day t 
- $$I(t)$$: number of infectious people on day t
- $$C(t)$$: number of critical people on day t 
- $$R(t)$$: number of recovered people on day t 
- $$D(t)$$: number of dead people on day t 

### Equations

The SEICRD system can be expressed by the following set of ordinary differential equations:

$$\frac{dS}{dt} = -\beta(t) \cdot I \cdot \frac{S}{N}$$ 

$$\frac{dE}{dt} = \beta(t) \cdot I \cdot \frac{S}{N} - \delta \cdot E$$ 

$$\frac{dI}{dt} = \delta \cdot E - \frac{1}{12} \cdot p(I→C) \cdot I - \gamma \cdot (1 - p(I→C)) \cdot I$$ 

$$\frac{dC}{dt} = \frac{1}{12} \cdot p(I→C) \cdot I - \frac{1}{7.5} \cdot p(C→D) \cdot min(Beds,C) - max(0,C-Beds) - \frac{1}{6.5} \cdot (1-p(C→D)) \cdot min(Beds,C)$$ 

$$\frac{dR}{dt} = \gamma \cdot (1-p(I→C)) \cdot I + \frac{1}{6.5} \cdot (1-p(C→D)) \cdot min(Beds,C)$$ 

$$\frac{dD}{dt} = \frac{1}{7.5} \cdot p(C→D) \cdot min(Beds,C) + max(0,C-Beds)$$ 

<!--
Which can be explained as follows:

- $$\frac{dS}{dt}$$: $$I$$ infectious people can infect $$S/N$$ people at a rate of $$\beta$$.

- $$\frac{dE}{dt}$$: The population going out of $$S$$ comes to $$E$$ (previous equation, opposite sign). Exposed people $$E$$ get infectious at a rate of $$\delta$$.

- $$\frac{dI}{dt}$$: The population going out of $$E$$ comes to $$I$$ (second term of previous equation, opposite sign). A proportion $$p(I→C)$$ of $$I$$ people get critically ill and goes to $$C$$ at a rate of $$1/12$$, and a proportion $$1 - p(I→C)$$ of $$I$$ people recover and goes to $$R$$ at a rate of $$\gamma$$.

- $$\frac{dC}{dt}$$: A proportion of $$p(I→C)$$ people going out of $$I$$ comes to $$C$$ at a rate of $$1/12$$ (second term of previous equation, opposite sign). A proportion $$p(C→D)$$ of $$min(Beds(t),C)$$ people dies and goes to $$D$$ at a rate of $$1/7.5$$; All $$max(0,C-Beds(t))$$ people go to $$D$$ and die due to bed shortage; a proportion $$1-p(C→D)$$ of $$min(Beds(t),C)$$ people recovers and goes to $$R$$ at a rate of $$1/6.5$$.

- $$\frac{dR}{dt}$$: A proportion of $$1-p(I→C)$$ people going out of $$I$$ comes to $$R$$ at a rate of $$\gamma$$ (second term of Infectious equation, opposite sign). A proportion $$1-p(C→D)$$ of $$min(Beds(t),C)$$ people goint out of $$C$$ comes to $$R$$ at a rate of $$1/6.5$$ (fourth term of previous equation, opposite sign).

- $$\frac{dD}{dt}$$: A proportion of $$p(C→D)$$ people going out of $$C$$ goes to $$D$$ at a rate of $$1/7.5$$ (second term of Critical equation, opposite sign). All $$max(0,C-Beds(t))$$ people going out of $$C$$ go to $$D$$ and die due to bed shortage (third term of critical equation, opposite sign).
-->
### Time dependent variables

A logistic function is used to describe $$R_0(t)$$:
 
$$ R_0(t) = \frac{R_0 start - R_0 end}{1 + e^{-k(-x + x_0)}} + R_0 end $$

It allows to take into account the effect of a lockdown on the spread of the disease.

### Parameters

The equations are solved using initial conditions (S0, I0, R0), along with the following set of parameters:

- $$N$$: total population 
- $$\beta(t)$$: expected amount of people an infectious person infects per day
- $$\gamma$$: rate of infectious recovering per day
- $$\delta$$: rate of exposed getting infectious per day (inverse of incubation period)
- $$p(I→C)$$: probability of going from infectious to critical 
- $$p(C→D)$$: probability of dying while critical 
- $$R_0start$$: initial value of $$R_0(t)$$ 
- $$R_0end$$: final value of $$R_0(t)$$ 
- $$x_0$$: inflection point of $$R_0(t)$$ (equivalent of lockdown day)
- $$k$$: slope of $$R_0(t)$$





## Data used

<iframe width="100%" height="750" frameborder="0" scrolling="no" src="//plotly.com/~stephanefevrier/298.embed?showlink=false"></iframe>

## Limitations, hypothesis


- Population is stable $$S(t) + I(t) + R(t) = N$$
- no vital things 

With these kind of models, we need to remember that:
- The system is really sensitive to initial parameters; slight changes can lead to completely different outcomes.
- Data (from coronavirus) is incomplete and the measurement is inconsistent between countries.
- Homogeneity among the whole population is assumed: initial hot spots and restrictions implemented earlier are not taken into account.

More specifically for the model we will build:
- Deaths do not change the population structure (age groups proportions for example), which is conserved during the whole pandemic (weak and reasonable assumption).
- Only critical cases go to hospital and will affect fatality rate through resource-shortage.
- All critical patients that do not get treatment die.
- Individuals are immune after recovering.
- $R_0$ only decreases or stay constant ; this model does not allow us to model measures being loosened again.

# Model fitting 

Model is describe. Now it's time to 



# Advanced compartmental model: SEICRD

- **S**usceptible - **E**xposed - **I**nfectious - **C**ritical - **R**ecovered - **D**ead
- Prediction of cases growth until 11 may for France
- Fitted $$R_0$$ on number of deaths for accuracy
- Need to constrain less on $$\gamma$$ and $$\delta$$

## parameters to fit 

- $$N$$: total population <span style="color:blue">**&rarr; Known from data**</span>
- $$\beta(t)$$: expected amount of people an infectious person infects per day <span style="color:blue">**&rarr; Known from data**</span>
- $$\gamma = 1/3$$: the proportion of infectious recovering per day (γ = 1/D) <span style="color:blue">**&rarr; Known from data**</span>
- $$R_0start$$: (parameter in R₀(t)) <span style="color:red">**&rarr; To fit**</span>
- $$R_0end$$: (parameter in R₀(t)) <span style="color:red">**&rarr; To fit**</span>
- $$x_0$$: (parameter in R₀(t)) <span style="color:red">**&rarr; To fit**</span>
- $$k$$: (parameter in R₀(t)) <span style="color:red">**&rarr; To fit**</span>
- $$s$$: (parameter in Beds(t)) <span style="color:red">**&rarr; To fit**</span>
- $$Beds_0$$: (parameter in R₀(t)) <span style="color:blue">**&rarr; Known from data**</span>
- $$\delta = 1/9$$: length of incubation period <span style="color:blue">**&rarr; Known from data**</span>
- $$p(I→C)$$: probability of going from infectious to critical <span style="color:red">**&rarr; To fit**</span>
- $$p(C→D)$$: probability of dying while critical <span style="color:red">**&rarr; To fit**</span>




## Data used



## Model fitted

CLick the legend to see the other compartments. 26 days of outbreak shift is hypothesed, meaning that the first case is supposed to be on 22/01 - 26 days 

<!-- main SEICRD -->
<iframe width="100%" height="500" frameborder="0" scrolling="no" src="//plotly.com/~stephanefevrier/241.embed?showlink=false"></iframe>

The $$R_0$$ is going down from a 

<!-- SEICRD R_0 -->
<iframe width="100%" height="500" frameborder="0" scrolling="no" src="//plotly.com/~stephanefevrier/243.embed?showlink=false"></iframe>


<!-- SEICRD Fatality Rate -->
<!--
<iframe width="100%" height="500" frameborder="0" scrolling="no" src="//plotly.com/~stephanefevrier/245.embed?showlink=false"></iframe>
-->

<!-- SEICRD Deaths per day -->
<iframe width="100%" height="500" frameborder="0" scrolling="no" src="//plotly.com/~stephanefevrier/247.embed?showlink=false"></iframe>


- We have the bell shape
- data fits pretty well
- after quarantine, the $$R_0$$ hypothesed to go up to 1.1 will let a constant number of people to die everyday.
